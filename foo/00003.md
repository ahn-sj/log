---
title: 파이썬에 들어가며.
tags: ["python", "gil", "queryset"]
categories: ["python", "gil"]
---

파이썬은 기존 자바와 다른 점이 일부 보인다.

아직 디테일한 부분을 이해하기엔 숙련도가 많이 부족하지만 일부는 공부하고 싶었다.

### 1. 자바와 파이썬에서의 멀티 스레드 활용

자바와 파이썬 모두 멀티스레드를 지원하지만 내부 동작 방식이나 활용 전략이 다른 부분이 있었다.<br/>
파이썬은 CPython 메모리 관리가 thread-safe 하지 않아서 전역 인터프리터 락(GIL, Global Interpreter Lock)으로 관리한다고 한다.<br/>
이로 인해 한 시점에 하나의 스레드만 파이썬 바이트 코드를 실행할 수 있다.

이 과정에서 하나의 스레드가 계속해서 점유하는 문제가 발생하면 기아 문제가 발생할 수 있어서 파이썬 3.x부터 약 5ms마다 GIL을 release하며 이를 방지한다고 함<br/>
결과적으로 파이썬의 멀티스레드는 멀티코어 CPU인 환경에서도 병렬(parallel)이 아닌 동시성(concurrency) 수준에서 동작이 됨<br/>
-> **자바에서는 멀티코어, 멀티스레드 환경이라면 병렬(parallel)적으로 동작한다**는 것에서 다름

다만, 이러한 원리더라도 작업의 성격에 따라 달라지는데 연산 처리(cpu-bound)가 많은 환경에서는 병렬성이 보장되지 않기 때문에 성능 향상이 없는 반면,<br/>
입출력 연산(io-bound)이 발생하면 GIL이 해제되는 원리를 가졌기 때문에 이때에는 다른 스레드가 실행된다고 함<br/>
-> 일부 글을 보면 '이러한 동작 원리로 인해 성능 향상이 된다'는 내용이 있는데 스레드 풀을 이용하던 스프링과 비교하면 결국,, 처리량은 떨어질 수 밖에 없다고 생각한다.<br/>
-> 근데 단순히 다른 전략과 비교하지 않고 GIL만 놓고 본다면 '웹 프레임워크'를 한정으로는 CPU-bound보다 IO-bound가 높으니 유리한 점은 맞다고 본다.

### 2. 동시성 제어 (수정 필요)

`1. 자바와 파이썬에서의 멀티 스레드 활용`의 내용만 본다면 한 시점에 하나의 스레드만 접근 가능하기 때문에 경쟁 상태(race condition)가 발생하지 않을 걸로 생각되는데, GPT말로는 발생할 수 있다고는 한다.<br/>
대략적으로 보면 전역변수를 다루는 상황에만 발생 가능한 것 같은데 이건 좀 더 알아볼 필요가 있을 것 같다.

### 3. 스케일 아웃 전략

또 정리를 하면서 처리량(throughput)을 늘리려면 결국 스케일 아웃이 필요하다.

근데 결국 멀티 스레드 환경이더라도 싱글 스레드처럼 동작한다면 꽤나 많이 확장을 해야겠다는 생각이 들었다.<br/>
그리고, 파이썬은 자바와 달리 멀티프로세스 모델을 활용하기 때문에 uWSGI나 Gunicorn과 같은 WSGI 서버는 여러 개의 프로세스를 띄워 각 프로세스가 독립된 GIL을 사용하게 함으로써 멀티코어를 활용한다고 한다.<br/>
또한, 워커(worker) 프로세스와 스레드(thread) 수를 직접 개발자가 조정을 해야한다고 한다. 
-> 결국 이렇게 되면 부하 테스트나 서버 스펙을 맞추어야 한다는건데 음,, 


